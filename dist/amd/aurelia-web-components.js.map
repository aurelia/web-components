{"version":3,"file":"aurelia-web-components.js","sources":["../../src/utilities.ts","../../src/custom-element-utilities.ts","../../src/custom-element-registry.ts"],"sourcesContent":["import { HtmlBehaviorResource } from 'aurelia-templating';\n\nexport const defineProperty = Reflect.defineProperty;\nexport const tagNameOf = (behavior: HtmlBehaviorResource) => behavior.elementName || behavior.target.name;\n\nconst sharedPropertyDescriptor = {\n  enumerable: false,\n  configurable: true,\n  get: undefined,\n  set: undefined\n} as PropertyDescriptor;\n\nexport const definePrototypeGetterSetter = <T extends object = object>(obj: T, propertyName: string, getter: () => any, setter: (val: any) => any): T => {\n  sharedPropertyDescriptor.get = getter;\n  sharedPropertyDescriptor.set = setter;\n  defineProperty(obj, propertyName, sharedPropertyDescriptor);\n  sharedPropertyDescriptor.get = sharedPropertyDescriptor.set = undefined;\n  return obj;\n};\n","import {\n  HtmlBehaviorResource,\n  BehaviorInstruction,\n  TargetInstruction,\n  ViewResources,\n  ViewSlot,\n  BoundViewFactory,\n  Controller,\n  View,\n  ViewCompiler\n} from 'aurelia-templating';\n\nimport {\n  Binding,\n  Scope,\n  InternalPropertyObserver\n} from 'aurelia-binding';\n\nimport {\n  Container\n} from 'aurelia-dependency-injection';\n\nimport {\n  DOM\n} from 'aurelia-pal';\n\nimport {\n  IGetterFunction\n} from './interface';\n\nimport {\n  definePrototypeGetterSetter,\n  defineProperty\n} from './utilities';\n\nconst emptyArray = Object.freeze([]) as any[];\n\nexport const createWebComponentClassFromBehavior = (\n  container: Container,\n  behavior: HtmlBehaviorResource,\n  viewResources: ViewResources,\n  compiler: ViewCompiler\n) => {\n\n  const CustomElementClass = class extends HTMLElement {\n\n    /**@internal */\n    _children: View[];\n    /**@internal */\n    _bindings: Binding[];\n    /**@internal */\n    au: { controller: Controller; };\n\n    constructor() {\n      super();\n\n      const behaviorInstruction = BehaviorInstruction.element(this, behavior);\n      const attributes = this.attributes;\n      const children = this._children = [];\n      const bindings = this._bindings = [];\n\n      behavior.processAttributes(compiler, viewResources, this, attributes, behaviorInstruction);\n\n      for (let i = 0, ii = attributes.length; i < ii; ++i) {\n        const attr = attributes[i];\n        behaviorInstruction.attributes[attr.name] = attr.value;\n      }\n\n      behavior.compile(compiler, viewResources, this, behaviorInstruction, this.parentNode);\n\n      const targetInstruction = TargetInstruction.normal(\n        0,\n        0,\n        [behavior.target],\n        [behaviorInstruction],\n        /*no expression*/emptyArray,\n        behaviorInstruction\n      );\n\n      const childContainer = createElementContainer(\n        container,\n        this,\n        targetInstruction,\n        children,\n        behaviorInstruction.partReplacements,\n        viewResources\n      );\n\n      const controller = behavior.create(childContainer, behaviorInstruction, this, bindings);\n      controller.created(null);\n    }\n\n    connectedCallback(): void {\n      let scope = { bindingContext: this, overrideContext: {} } as Scope;\n      this.au.controller.bind(scope);\n      this._bindings.forEach(x => x.bind(scope));\n      this._children.forEach(x => x.bind(scope.bindingContext, scope.overrideContext, true));\n\n      this.au.controller.attached();\n      this._children.forEach(x => x.attached());\n    }\n\n    disconnectedCallback(): void {\n      this.au.controller.detached();\n      this._children.forEach(x => x.detached());\n\n      this.au.controller.unbind();\n      this._bindings.forEach(x => x.unbind());\n      this._children.forEach(x => x.unbind());\n    }\n\n    attributeChangedCallback(attrName: string, oldValue: string, newValue: string): void {\n      const bindable = behavior.attributes[attrName];\n      if (bindable !== undefined) {\n        this.au.controller.viewModel[bindable.name] = newValue;\n      }\n    }\n  };\n\n  const CustomElementViewModelClass = behavior.target;\n  const proto = CustomElementClass.prototype;\n  const observedAttributes: string[] = [];\n\n  behavior.properties.forEach(bindableProperty => {\n\n    const getterFn = function () {\n      return this.au.controller.viewModel[bindableProperty.name];\n    } as IGetterFunction;\n\n    getterFn.getObserver = function(obj: any) {\n      return getObserver(container, behavior, obj.au.controller.viewModel, bindableProperty.name);\n    };\n\n    definePrototypeGetterSetter(\n      proto,\n      bindableProperty.name,\n      getterFn,\n      function (value: unknown) {\n        this.au.controller.viewModel[bindableProperty.name] = value;\n      }\n    );\n\n    observedAttributes.push(bindableProperty.attribute);\n  });\n\n  defineProperty(CustomElementClass, 'observedAttributes', {\n    get: () => observedAttributes\n  });\n\n  // Object\n  //   .keys(CustomElementViewModelClass.prototype)\n  //   .forEach(key => {\n  //     const descriptor = Reflect.getOwnPropertyDescriptor(CustomElementViewModelClass.prototype, key);\n  //     if (typeof descriptor.value === 'function') {\n  //       proto[key] = function (...args: any[]) {\n  //         return this.au.controller.viewModel[key](...args);\n  //       };\n  //     }\n  //   });\n\n  return CustomElementClass;\n};\n\nconst getObserver = (\n  container: Container,\n  behavior: HtmlBehaviorResource,\n  instance: object & { __observers__: any; },\n  name: string\n): InternalPropertyObserver => {\n  let lookup = instance.__observers__;\n\n  if (lookup === undefined) {\n    if (!behavior.isInitialized) {\n      behavior.initialize(container, instance.constructor);\n    }\n\n    lookup = behavior.observerLocator.getOrCreateObserversLookup(instance);\n    behavior._ensurePropertiesDefined(instance, lookup);\n  }\n\n  return lookup[name];\n};\n\nfunction elementContainerGet(this: Container, key: any): any {\n  if (key === DOM.Element) {\n    return this.element;\n  }\n\n  if (key === BoundViewFactory) {\n    if (this.boundViewFactory) {\n      return this.boundViewFactory;\n    }\n\n    let factory = this.instruction.viewFactory;\n    let partReplacements = this.partReplacements;\n\n    if (partReplacements) {\n      factory = partReplacements[factory.part] || factory;\n    }\n\n    this.boundViewFactory = new BoundViewFactory(this, factory, partReplacements);\n    return this.boundViewFactory;\n  }\n\n  if (key === ViewSlot) {\n    if (this.viewSlot === undefined) {\n      this.viewSlot = new ViewSlot(this.element, this.instruction.anchorIsContainer);\n      this.element.isContentProjectionSource = this.instruction.lifting;\n      this.children.push(this.viewSlot);\n    }\n\n    return this.viewSlot;\n  }\n\n  if (key === ViewResources) {\n    return this.viewResources;\n  }\n\n  if (key === TargetInstruction) {\n    return this.instruction;\n  }\n\n  return this.superGet(key);\n}\n\nconst createElementContainer = (\n  parent: Container,\n  element: Element,\n  instruction: TargetInstruction,\n  children: View[],\n  partReplacements: Record<string, any>,\n  resources: ViewResources\n): Container => {\n  const container = parent.createChild();\n  const provider = instruction.providers[0];\n\n  container.element = element as Element & { isContentProjectionSource: boolean };\n  container.instruction = instruction;\n  container.children = children;\n  container.viewResources = resources;\n  container.partReplacements = partReplacements;\n\n  container.registerSingleton(provider, provider);\n\n  container.superGet = container.get;\n  container.get = elementContainerGet;\n\n  return container;\n};\n","import { Container } from 'aurelia-dependency-injection';\nimport { HtmlBehaviorResource, ViewCompiler, ViewResources, ViewFactory } from 'aurelia-templating';\nimport { createWebComponentClassFromBehavior } from './custom-element-utilities';\nimport './interface';\nimport { ICustomElementInfo, ICustomHtmlRegistry } from './interface';\nimport { tagNameOf } from './utilities';\nimport { metadata } from 'aurelia-metadata';\n\nexport class CustomElementRegistry implements ICustomHtmlRegistry {\n\n  static inject = [Container, ViewCompiler, ViewResources];\n\n  /**\n   * Custom element name must have hyphen. With custom elements that do not have, prefix with `au-`\n   */\n  fallbackPrefix: string;\n\n  /**@internal */\n  private _lookup: Record<string, ICustomElementInfo>;\n\n  /**@internal */\n  private container: Container;\n\n  /**@internal */\n  private viewCompiler: ViewCompiler;\n\n  /**@internal */\n  private viewResources: ViewResources;\n\n  constructor(container: Container, viewCompiler: ViewCompiler, viewResources: ViewResources) {\n    this.fallbackPrefix = 'au-';\n    this._lookup = Object.create(null);\n    this.container = container;\n    this.viewCompiler = viewCompiler;\n    this.viewResources = viewResources;\n  }\n\n  /**\n   * Use all global elements from current view resources and define them as native custom element\n   */\n  useGlobalElements(): Function[] {\n    const viewResources = this.viewResources;\n    // store reference to all existing global resources\n    const elements = viewResources.elements;\n    // remove all global element resources\n    viewResources.elements = Object.create(null);\n\n    return Object.keys(elements).map(tagName => {\n      const behavior = elements[tagName];\n      return this.registerBehavior(behavior, tagName).classDefinition;\n    });\n  }\n\n  /**@internal */\n  registerBehavior(behavior: HtmlBehaviorResource, tagName?: string): ICustomElementInfo {\n    const classDefinition = createWebComponentClassFromBehavior(\n      this.container,\n      behavior,\n      this.viewResources,\n      this.viewCompiler\n    );\n    tagName = tagName || tagNameOf(behavior);\n\n    const info: ICustomElementInfo = this._lookup[tagName] = {\n      tagName: tagName,\n      behavior: behavior,\n      classDefinition: classDefinition\n    };\n\n    if (tagName.indexOf('-') === -1) {\n      tagName = this.fallbackPrefix + tagName;\n    }\n\n    customElements.define(tagName, classDefinition);\n\n    return info;\n  }\n\n  register(Type: Function): Promise<Function> {\n    let htmlBehaviorResource = metadata.get(metadata.resource, Type) as HtmlBehaviorResource;\n    // validating metadata\n    if (htmlBehaviorResource) {\n      ViewResources.convention(Type, htmlBehaviorResource);\n    } else {\n      htmlBehaviorResource = ViewResources.convention(Type) as HtmlBehaviorResource;\n    }\n    if (!(htmlBehaviorResource instanceof HtmlBehaviorResource) || htmlBehaviorResource.elementName === null) {\n      throw new Error(`class ${Type.name} is already associated with a different type of resource. Cannot register as a custom element.`);\n    }\n\n    const customElementInfo = this.registerBehavior(htmlBehaviorResource, Type['is']);\n    return htmlBehaviorResource\n      .load(this.container, Type)\n      .then(() => customElementInfo.classDefinition);\n  }\n\n  has(Type: Function): boolean {\n    let htmlBehaviorResource = metadata.get(metadata.resource, Type) as HtmlBehaviorResource;\n    if (!htmlBehaviorResource || !(htmlBehaviorResource instanceof HtmlBehaviorResource)) {\n      return false;\n    }\n    return this._lookup[tagNameOf(htmlBehaviorResource)] !== undefined;\n  }\n}\n"],"names":["tslib_1.__extends","BehaviorInstruction","TargetInstruction","DOM","BoundViewFactory","ViewSlot","ViewResources","metadata","HtmlBehaviorResource","Container","ViewCompiler"],"mappings":"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"}